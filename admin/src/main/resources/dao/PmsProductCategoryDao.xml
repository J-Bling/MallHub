<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mall.admin.dao.pms.PmsProductCategoryDao">
    <!-- 插入商品分类 -->
    <insert id="insertCategory" parameterType="com.mall.mbg.model.PmsProductCategory" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO pms_product_category (
        parent_id, name, level, product_count, product_unit,
        nav_status, show_status, sort, icon, keywords, description
        ) VALUES (
        #{parentId}, #{name}, #{level}, #{productCount}, #{productUnit},
        #{navStatus}, #{showStatus}, #{sort}, #{icon}, #{keywords}, #{description}
        )
    </insert>

    <!-- 更新商品分类 -->
    <update id="updateCategory" parameterType="com.mall.mbg.model.PmsProductCategory">
        UPDATE pms_product_category SET
        parent_id = #{parentId},
        name = #{name},
        level = #{level},
        product_count = #{productCount},
        product_unit = #{productUnit},
        nav_status = #{navStatus},
        show_status = #{showStatus},
        sort = #{sort},
        icon = #{icon},
        keywords = #{keywords},
        description = #{description}
        WHERE id = #{id}
    </update>

    <!-- 删除商品分类 -->
    <delete id="deleteCategory" parameterType="java.lang.Long">
        DELETE FROM pms_product_category WHERE id = #{id}
    </delete>

    <!-- 根据ID查询商品分类 -->
    <select id="selectById" parameterType="java.lang.Long" resultType="com.mall.mbg.model.PmsProductCategory">
        SELECT * FROM pms_product_category WHERE id = #{id}
    </select>

    <!-- 根据父ID查询商品分类列表 -->
    <select id="selectByParentId" parameterType="java.lang.Long" resultType="com.mall.mbg.model.PmsProductCategory">
        SELECT * FROM pms_product_category
        WHERE parent_id = #{parentId}
        ORDER BY sort DESC
    </select>

    <!-- 统计同名分类数量 -->
    <select id="countByNameAndParentId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM pms_product_category
        WHERE name = #{name} AND parent_id = #{parentId}
    </select>

    <!-- 统计子分类数量 -->
    <select id="countByParentId" parameterType="java.lang.Long" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM pms_product_category WHERE parent_id = #{parentId}
    </select>

    <!-- 更新导航栏显示状态 -->
    <update id="updateNavStatus">
        UPDATE pms_product_category
        SET nav_status = #{navStatus}
        WHERE id = #{id}
    </update>

    <!-- 更新前台显示状态 -->
    <update id="updateShowStatus">
        UPDATE pms_product_category
        SET show_status = #{showStatus}
        WHERE id = #{id}
    </update>

    <!-- 更新商品数量 -->
    <update id="updateProductCount">
        UPDATE pms_product_category
        SET product_count = product_count + #{delta}
        WHERE id = #{id}
    </update>

    <!-- 统计分类下的商品数量 -->
    <select id="countProductByCategoryId" parameterType="java.lang.Long" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM pms_product
        WHERE product_category_id = #{categoryId} AND delete_status = 0
    </select>
</mapper>